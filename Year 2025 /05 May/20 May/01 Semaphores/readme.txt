read the comments and implement producer and consumer using semaphores becomes very much easier 
